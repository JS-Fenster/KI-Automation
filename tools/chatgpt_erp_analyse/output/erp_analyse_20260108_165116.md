# ChatGPT o3 ERP-Analyse (Maximum Reasoning)

**Datum:** 2026-01-08 16:51
**Model:** o3 mit reasoning_effort: high
**Kontext:** 552,345 Zeichen
**Tokens verbraucht:** 180,244

---

============================================================
1. IST-ANALYSE
============================================================

1.1 Analysierte Geschäfts- & Support-Prozesse  
A) Vertrieb & Auftragsabwicklung  
   1. Lead-Erfassung (Telefon, Mail, Web, Laden)  
   2. Angebotserstellung (Voraufmaß → Kalkulation)  
   3. Auftragsbestätigung / Bestellung beim Hersteller  
   4. Wareneingang, Lager, Kommissionierung  
   5. Montage­planung & ‑durchführung  
   6. Rechnungsstellung, Zahlung, Mahnwesen  
   7. After-Sales (Rekla, Wartung, Förder­nachweis)

B) Service / Reparatur  
   8. Ticketanlage, Teile­recherche, Terminierung  
   9. Service-Montage, Abschluss, Rechnung

C) Innere Organisation  
  10. Personal­verwaltung (Urlaub, Zeiten)  
  11. Einkauf & Lieferanten­management  
  12. Buchhaltung / DATEV  
  13. Inventar, Fuhrpark, Prüf- & Bürgschafts­fristen  
  14. Marketing / Referenzen / Google-Reviews

1.2 Geplantes Datenmodell (Supabase / Prisma)  
• Kernobjekte: User, Customer, Project, Document, Position, Supplier, Order, Repair, Appointment, AuditLog, Embedding, NumberSequence, GPSPosition.  
• Dokument-Kette (parentId) bildet „QUOTE → ORDER → INVOICE“.  
• Positions-Versionierung (never delete, status-Feld).  
• Repair enthält Photos, Parts, Notes; Embedding-Tabelle für KI-Suche.  
• w4aCode‐Felder für spätere Historien-Joins.  
• RLS (row level security) vorgesehen, Rollen: ADMIN, OFFICE, TECHNICIAN, CUSTOMER.  
• Soft-Delete über deletedAt; Änderungs-Audit in AuditLog.

1.3 Geplante Features (kompakt nach Domänen)  
Vertrieb  
  – 5-Min-Budgetpreis, KI-Kalkulator, XML/PDF-Import externer Konfiguratoren.  
  – Angebots-PDF-Generator (Briefpapier, Wasserzeichen).  
  – Pipeline-Dashboard + Follow-up-Automatik.

Einkauf / Logistik  
  – Beschaffungs-Cockpit, Teilmengen, AB-Abgleich, Ampel für Liefer­verzug.  
  – Lagerbuchung, Mindest­bestand-Alarm, Inventur-QR.

Montage  
  – Kalender/Board (FullCalendar), Wetter-Check, Tages­briefing, Live-Status, GPS-Zeitstempel.  
  – Monteur-PWA (Fotos, Sprache, Unterschrift, Offline-Sync).

Service / Reparatur  
  – „Stefan-App“-MVP: KI-Bildanalyse, Termin-Bot, Ersatzteil-Autobestellung < 50 €.  
  – Back-Office-Dashboard, Status-Board.

Finanzen  
  – Rechnung → HBCI-Abgleich → Mahn-Automat → DATEV-Export (PDF-Merger).  
  – Anzahlungs-Erinnerung, BAFA-Reminder.

Organisation  
  – Urlaub/Überstunden-Script, Jahres­übertrag, Führerschein- & DGUV-Reminder.  
  – Referenz-Management, Google-Review-Trigger, Marketing-Auswertung.

1.4 Bereits implementiert  
✔ Dokument-Tabellen & Grund-CRUD (Supabase/Prisma)  
✔ PDF-Generator-Prototyp (Briefpapier-Layer)  
✔ Lesender SQL-Connector auf W4A (pymssql) + Cloudflare-Tunnel  
✔ Phase-0-Infrastruktur (Docker-Compose, Auth-Grundgerüst)  
⚠ RLS-Policies noch offen  
⚠ Repair-Board, Kalender, KI-Worker, Lager-Logik, Einkaufs-Cockpit, Migration-Skripte noch nicht begonnen  
⚠ Inkonsistenz Tech-Stack: Teile Next.js, Teile Vite-React, Entscheidung vertagt


============================================================
2. ERP BEST PRACTICES (Handwerk ≤ 15 MA)
============================================================

2.1 Datenstruktur  
• Klar getrennte Hauptentitäten: Kunde – Projekt – Dokument – Position – Einsatz – Zeit – Zahlung – Artikel.  
• Ein Nummernkreis pro Belegart, zentrale NumberSequence-Tabelle (Thread-safe, Vorbelegung).  
• Audit-Log (wer / wann / alt / neu), Soft-Delete, Versionierung für Positionen.  
• Referenzielle Integrität durch FK-Constraints + ON DELETE RESTRICT.  
• „Header-Detail“-Design (Dokument/Position) + Status-Machine statt vielen Einzelfeldern.  
• Dateispeicher (S3, Supabase Storage) logisch mit Document verknüpft (1:m Anhänge).  
• Rollen- & Rechte­modell (min. Admin, Innendienst, Außendienst, Extern).  
• Zeitreihentabellen für GPS, Arbeitszeiten, Lagerbewegungen → keine Historienlücken.  
• Trennung: operative DB vs. Reporting-Schema (Materialised Views).

2.2 Standard-Workflows (Fensterbauer)  
Lead → Grobkalkulation → Aufmaß → Angebot → Auftrag → Bestellung/Lieferavis → Wareneingang → Montageplanung → Ausführung (Fotos, Zeiten, Restliste) → Rechnung → Zahlung/Mahnung → Garantie & Wartung.  
Service-Ticket → Diagnose → Teile­bestellung → Termin → Ausführung → Rechnung.  
Querläufer: Lager, Einkauf, Personalzeit, Compliance, Dokumenten­management.

2.3 Häufige Fallstricke  
• Zwei Datenquellen (Excel + ERP) → Divergenz.  
• „Mail- & Outlook-ERP“: Termine, Belegkopien, Fotos liegen in Postfächern.  
• Keine AB-Kontrolle ⇒ Fehlmengen tauchen erst beim Monteur auf.  
• Montage-Rückmeldung auf Papier ⇒ Nachkalkulation ungültig.  
• Fehlende Lager-Buchungen ⇒ Pufferteile nie nachbestellt.  
• Reparatur-Tickets ohne Termin-Status ⇒ „vergessene Kunden“.  
• Falsch parametrierte Nummernkreise ⇒ Doppel-/Lückensätze in DATEV.  
• DIY-Skripte ohne Rechtekonzept ⇒ Sicherheits- & DSGVO-Risiko.  
• KI-Euphorie ⇒ zu früh autonom, ohne Fallback & Audit.


============================================================
3. BEWERTUNG DES AKTUELLEN PLANS
============================================================

3.1 Stark / Gut gelöst  
✓ Schrittweise Ablösung („Option B“) mit Parallel-Read & spätem Cut-over – minimiert Downtime-Risiko.  
✓ Klares Kern-Datenmodell mit Document-Chain & Positions-Versionierung.  
✓ Niedrige TCO: Supabase + Hetzner schlagen Lizenzkosten von W4A.  
✓ KI-Module nicht pauschal, sondern use-case-basiert (Bildanalyse Service, Voice-Bot Termin).  
✓ Offline-First-PWA-Ansatz für Monteure – praxisnah (Baustelle ohne Empfang).  
✓ Audit-/Confidence-System konzipiert – wichtig bei Auto-Bestellungen.  
✓ DATEV-Limit (1 PDF) bereits im Design berücksichtigt (Merger).

3.2 Fehlend / Unklar  
– Migrationsskripte (Mapping BZObjType ➜ Document.parentId/Type).  
– Endgültige Stack-Entscheidung: Next.js vs. Vite-React; Backend: API Routes vs. Fastify.  
– RLS-Policies, Passwortrichtlinie, MFA, Secrets-Management.  
– Offline-Conflict-Resolution (Service-Worker-Queues, Retrys, Merge-Strategie).  
– Test-/CI-Pipeline, Rollback, Playground vs. Prod-DB-Trennung.  
– Vollständige Lager-& Seriennummer-Logik (Fensterrahmen ≠ Schraubenkiste).  
– Rechtliche Klärung: GPS + Sprach­aufnahmen (Einwilligungen speichern!).  
– Hardware-MDM-Konzept (Geräteverlust, Remote-Wipe).  
– Endnutzer-Schulung, Support-Prozess, Change-Management.

3.3 Probleme / Inkonsistenzen  
• Konzept 2 (Reparatur-MVP) legt Next.js14 fest; Randbedingung fordert Vite-React.  
• Cloud KI-API vs. DSGVO (Kundenfotos) – noch kein AV-Vertrag / EU-Region.  
• „W4A only read“ verhindert automatische Anzahlungs-Rechnungen in Parallelphase.  
• FullCalendar Premium ­Kosten ungeklärt, Lizenzpflicht ab Resource-Timeline.  
• Zwei Auth-Implementierungen (NextAuth und selbstgeschriebene Credentials) angekündigt.  
• Service-App offline aber Voice-Bot online → Fehlerfälle/Timeouts nicht beschrieben.  
• OpenVPN-Tunnel mit SA/PW in Klartext → akutes Risiko.

============================================================
4. VERBESSERUNGSVORSCHLÄGE
============================================================

4.1 Konkrete Nächste Schritte  
1. TECH-DECISION FIX (1 Woche)  
   – Frontend: Vite + React (oder endgültig Next.js).  
   – Backend: Fastify + tRPC oder Next API Routes.  
   – Auth: Auth.js + Supabase Auth, MFA optional.  
   – CI: GitHub Actions (lint, typecheck, e2e, push to Docker Hub).  

2. SECURITY HARDENING (2 Tage)  
   – Neues SA-Passwort, Tunnel ≥ IP-Whitelist + 2FA.  
   – .env in Vault (Doppler, 1Password) – nie im Repo.  

3. MINIMALES KERNMODELL LIVE (MVP 1)  
   – Tabellen: User, Customer, Project, Document, Position, NumberSequence.  
   – Funktionen: Lead → Angebot → Auftrag → Rechnung (PDF) → Zahlungserfassung.  
   – Oberfläche:  
       • Kunden-CRUD, Angebots-Wizard (3 Schritte)  
       • Dokumentliste mit Status-Badges  
       • PDF-Download, E-Mail-Versand (SendGrid)  

4. RLS & RBAC (parallel)  
   – Policy-Generator-Script, Unit-Tests.  
   – Rollen Admin/Office/Technician; spätere Kunde-Rolle.  

5. MIGRATION SCRIPT V1 (read-only)  
   – Export Angebot/Positionen>2022 → history-Schema.  
   – Jobs: nightly incremental via ChangedDate.  

6. MONTEUR-PWA ALPHA (MVP 2)  
   – Login, Tagesplan (nur JSON-Push), Foto & Unterschrift Upload, Offline-Queue.  
   – Service-Worker: Workbox, Background Sync, IndexedDB.  

7. REPARATUR-MVP (MVP 3)  
   – Ticket-Form (Foto, Sprache): /repairs/new.  
   – KI-Analyse als Hintergrundjob (rate-limited).  
   – Termin-Status (NEW → WAIT_PARTS → SCHEDULED → DONE → INVOICED).  

8. AB-ABGLEICH & LAGER (MVP 4)  
   – Order + Delivery-Tables, Teilmengen, Wareneingang-Scan (QR).  

4.2 Priorisierung  
P0  Security, Stack-Entscheidung  
P1  Dokument-Flow / Rechnung (= Cash-Flow)  
P2  Montage-Rückmeldung (= verlorene Umsätze stoppen)  
P3  Reparatur-MVP (= größter Zeitfresser)  
P4  Beschaffung + AB-Abgleich (= Montageausfälle)  
P5  After-Sales / Förder­Reminder  
P6  KI-Nice-to-Have (Lead-Preisfoto, Voll-Autobestellung)

4.3 Technische Hinweise  
• Nummernkreis: FOR UPDATE-Select aus number_sequence, Transaktion + Retry → Race-safe.  
• Offline-Sync: Persistente UUID je Record, Merge-Strategie „client wins if updatedAt > server“.  
• Medien: Supabase Storage mit RLS (public = false); signed URLs 24 h.  
• PDF-Service: Node-queue (BullMQ) + Playwright/Chromium → keine Zeitouts im API-Thread.  
• KI-Calls: Wrapper mit Budget-Limiter ($/Tag); fallbackText bei Fehler > 5 s.  
• Tests: Vitest + Playwright; Cypress für PWA offline.  
• Telemetry: Sentry (errors) + Umami (Usage).  
• Docs: Storybook + Tech-ADR-Repo.  

============================================================
5. FEHLENDE INFORMATIONEN
============================================================

• Genaue Mitarbeiter-Rollen + IT-Affinität (Schulungs­aufwand UI).  
• Soll-Durchlaufzeiten (Anfrage→Rechnung) als KPI-Basis.  
• Ausfall­kosten pro Montage­tag → Priorisierung Liefer-/Montage-Module.  
• Welche Hersteller bieten echte APIs? (Weru XML ok; Warema, Drutex?)  
• Braucht DATEV-Steuerberater nur Buchungs-CSV oder Belegbild-Link?  
• Vertrags-/Förder-Dokumente: müssen digital signiert werden? (eIDAS)  
• Akzeptieren Monteure Firmen-Smartphone Android 12 oder BYOD?  
• Kundensprache DE/EN? (Übersetzungs-Pflicht UI & PDF)  
• Back-Office-Skillset: SQL / No-Code-Tools?  
• Max. Offline-Zeit: 1 Tag? 1 Woche?  
→ Antworten steuern Offline-Strategie, App-Cache-Größe, Training.

Fragen, die sich der Entwickler stellen sollte  
1. Welcher Single-Source-of-Truth für Artikel­stammdaten (Preis, Maße)?  
2. Muss Lager Seriennummern (Barcode Fenster) oder nur Stückzahl können?  
3. Wie wird BAFA-Deadline rechtlich sauber getrackt (Fristbeginn, Nachweis)?  
4. Was passiert bei KI-Fehl-Bestellungen > 50 €? (Genehmigungs-Flow)  
5. Welche Reports braucht der Steuerberater monatlich / jährlich?  
6. Wie wird Change-Management & Schulung durchgeführt (Videos, Wiki, On-Site)?  

============================================================
6. ROADMAP-VORSCHLAG (12 Monate)
============================================================

Phase 0 – Foundation (0-4 Wochen)  
 • Stack-Fixierung, Repo-Setup, CI/CD, Security-Hardening  
 • Core-DB-Migrations via Prisma, NumberSequence, Auth, Audit  
 • einfache Admin-UI (CRUD auf Stammdaten)

Phase 1 – MVP Cash-Flow (Monat 2-3)  
 • Dokument-Flow: Angebot → Auftrag → Rechnung (+ PDF)  
 • Kunden-& Projekt-CRUD, einfache Offene-Posten-Liste  
 • Import von aktiven W4A-Aufträgen (read-only)

Phase 2 – Montage-App (light) (Monat 4-5)  
 • Kalender-View für Büro, Tagesplan-JSON für PWA  
 • Monteur-PWA: Check-in/-out, Fotos, Unterschrift, Offline-Sync  
 • Rückmeldungen schreiben Zeiten in DB → Nachkalkulation

Phase 3 – Reparatur-MVP (Monat 6-7)  
 • Ticket-Form (Foto, Sprache), KI-Analyse, Teile-Vorschlag  
 • Status-Board & Termin-Funktion (kein Bot v1)  
 • Rechnung direkt aus Ticket (Dienstleistungs-Artikel)

Phase 4 – Einkauf & Lager (Monat 8-9)  
 • Order-Table, Lieferavis, AB-Upload, Teilmengen, Wareneingang-Scan  
 • Mindestbestand-Alerts & Inventur-QR  
 • Ampel-Beschaffungsdashboard

Phase 5 – Automation / KI + After-Sales (Monat 10-11)  
 • Bot-Terminierung, Auto-Bestellung ≤ 50 €  
 • BAFA-Reminder, Google-Review-Trigger, Wartungs-Vertrag-Modul  
 • Voice-/Chat-Assistent (Whisper + GPT) für Angebotserfassung

Phase 6 – Abschaltung W4A (Monat 12)  
 • Finalmigration restliche Historie → history-Schema  
 • Abmelde-Lizenz, Benutzer-Schulung auf neues System  
 • Post-GoLive Hypercare (4 Wochen, Fehler ≤ 1 Tag Fix)

MVP-Definition  
• Muss Rechnungen erstellen & buchen können  
• Muss Montage-Rückmeldungen digital erfassen  
• Muss Service-Tickets anlegen & terminieren  
→ Erfüllt ab Ende Phase 3.

Spätere Phase 7+ (Optional)  
• Marketing-Foto-Preis-KI  
• GPS-Routenoptimierung  
• Kunden-Portal (Self-Service PDFs, Termine)  
• BI-Dashboard (Deckungsbeiträge, Forecasts)  

============================================================
ENDE
============================================================