# CE-Datenmodell fuer Fensterbau-ERP

Im Folgenden zuerst das Datenmodell in **Prisma-Schema** (für Supabase/PostgreSQL), mit Tabellen, Relationen und Kommentierten Feldern. Danach ein **Beispiel** für eine CE-Leistungserklärung für ein Kunststoff-Fenster in JSON.

---

## Prisma Schema

```prisma
// schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Product {
  id                    Int                       @id @default(autoincrement())
  product_type          String                    // Typbezeichnung, notwendig für CE-Leistungserklärung („Produkt-Typ“)
  name                  String
  description           String?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  // Verknüpfungen:
  ceDeclarations        CEDeclaration[]           // Mehrere Leistungserklärungen historisch
  materialComponents     ProductMaterialComponent[] // Profil, Glas, Beschlag Komponenten

  serialBatches          SerialOrBatch[]           // Seriennummern oder Chargen
  warrantyContracts      WarrantyContract[]        // Garantie Verträge
  maintenanceContracts   MaintenanceContract[]     // Wartungsverträge
  costEstimations        CostEstimation[]          // Soll-Kosten aus Angebot
}

model CEDeclaration {
  id                          Int          @id @default(autoincrement())
  product                     Product      @relation(fields: [productId], references: [id])
  productId                  Int
  // Pflichtfelder nach EU-Regulation (neu EU 2024/3110 ersetzt EU 305/2011 ab 8. Januar 2026) ([remade.it](https://www.remade.it/en/news/construction-products-a-new-european-regulation-is-coming-into-force/?utm_source=openai))

  declarationNumber          String       // eindeutiger Identifikator der Erklärung
  issueDate                  DateTime     // Ausstellungsdatum
  manufacturerName           String       // Herstellername
  manufacturerAddress        String       // Adresse Hersteller
  harmonisedStandard         String       // Referenz harmonisierter Norm (Nummer + Ausgabe) ([eur-lex.europa.eu](https://eur-lex.europa.eu/eli/reg/2011/305/2024-11-17/eng?utm_source=openai))
  assessmentSystem           String       // System zur Bewertung/Aufrechterhaltung der Leistungskonstanz ([eur-lex.europa.eu](https://eur-lex.europa.eu/eli/reg/2011/305/2024-11-17/eng?utm_source=openai))
  intendedUse                String       // Verwendungszweck laut Norm ([eur-lex.europa.eu](https://eur-lex.europa.eu/eli/reg/2011/305/2024-11-17/eng?utm_source=openai))

  // Wesentliche Leistungswerte / Essential Characteristics (je Produkt relevant)
  thermalTransmittanceUw     Float?       // Uw-Wert (W/m²K), wichtig für Energieeffizienz
  airPermeabilityClass        String?      // z. B. Klasse A, B, C oder numerisch
  watertightnessClass         String?      // Schlagregendichtheitsklasse
  soundReductionRw            Float?       // Schallschutz (z. B. Rw in dB)
  windLoadResistanceClass     String?      // Windlastklasse
  safetyGlazing               Boolean?     // Nur wenn Glas relevant
  // etc. beliebig erweiterbar

  environmentalPerformance    Json?        // Nachhaltigkeitsaspekte / EN 2024/3110 verlangt Lebenszyklusdaten ([economie.fgov.be](https://economie.fgov.be/en/themes/enterprises/specific-sectors/construction/construction-products/regulation-eu-20243110/declaration-performance-and?utm_source=openai))

  // Aufbewahrung
  validUntil                  DateTime     // bis wann gültig
  archived                    Boolean      @default(false) // Kennzeichnung für >10 Jahre Aufbewahrung

  // Dokumente
  documentUrl                 String?      // Link oder Pfad zum PDF/Datei
  // Audit
  createdAt                   DateTime     @default(now())
  updatedAt                   DateTime     @updatedAt
}

model SerialOrBatch {
  id               Int          @id @default(autoincrement())
  product           Product      @relation(fields: [productId], references: [id])
  productId         Int
  isSerial          Boolean      // true = einzelne Seriennummer, false = Charge
  identifier        String       // Seriennummer oder Chargenummer
  quantity          Int?         // wenn Charge: Stückzahl
  producedAt        DateTime?    // Datum Fertigung
  deliveredAt       DateTime?    // Datum Lieferung
  // Verknüpfung zu Positionen (z. B. Aufträge), Reklamationen
  orderPositions     OrderPosition[]     // oder ähnlich
  complaints         Complaint[]          // Mängel verknüpft

  createdAt          DateTime     @default(now())
}

model Supplier {
  id               Int         @id @default(autoincrement())
  name             String
  address          String
  contactPerson    String?
  phone            String?
  email            String?
  materials        Material[]   // was liefert dieser Lieferant?
  complaints       Complaint[]  // Rückmeldung bei Reklamationen
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}

model Material {
  id               Int         @id @default(autoincrement())
  supplier         Supplier     @relation(fields: [supplierId], references: [id])
  supplierId       Int
  name             String      // z. B. „Profilsystem X“, „Isolierglas Y“
  type             String      // Profil / Glas / Beschlag / Fuge etc.
  technicalSpecs   Json?       // Glasdicke, Wärmeleitwert, Beschlag Traglast etc.
  stockNumber      String?     // Artikelnummer beim Lieferanten
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  productComponents ProductMaterialComponent[]
}

model ProductMaterialComponent {
  id             Int       @id @default(autoincrement())
  product        Product   @relation(fields: [productId], references: [id])
  productId      Int
  material       Material  @relation(fields: [materialId], references: [id])
  materialId     Int
  quantity       Float     // Menge (z. B. Meter, Stück, m2 etc.)
}

model Complaint {
  id                  Int          @id @default(autoincrement())
  serialOrBatch       SerialOrBatch? @relation(fields: [serialOrBatchId], references: [id])
  serialOrBatchId     Int?
  product             Product?       @relation(fields: [productId], references: [id])
  productId           Int?
  supplier            Supplier?       @relation(fields: [supplierId], references: [id])
  supplierId          Int?

  ticketNumber         String        // Eindeutige Reklamationsnummer
  dateReported         DateTime
  description          String       // Was ist das Problem
  cause                String?      // Fehlerursache, wenn ermittelt
  measuresTaken        String?      // Maßnahmen intern
  supplierFeedback     String?      // Rückmeldung vom Lieferanten
  resolutionDate       DateTime?    // Wann abgeschlossen
  status               String       // z. B. 'open', 'investigating', 'resolved'
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt
}

model CostEstimation {
  id                 Int       @id @default(autoincrement())
  product             Product  @relation(fields: [productId], references: [id])
  productId           Int
  estimateDate        DateTime // Datum Angebot
  estimatedMaterialCost Float    // Soll Kosten Material
  estimatedLaborCost   Float    // Soll Kosten Arbeitszeit
  estimatedTravelCost  Float    // Soll Fahrtkosten
  actualMaterialCost   Float?   // Ist Kosten, nach Produktion
  actualLaborCost      Float?
  actualTravelCost     Float?
  varianceMaterial     Float?   // Abweichung berechnet
  varianceLabor       Float?
  varianceTravel      Float?
  notes               String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model WarrantyContract {
  id                  Int       @id @default(autoincrement())
  product             Product   @relation(fields: [productId], references: [id])
  productId           Int
  contractType        String    // z. B. „Standard“, „Premium“, „Erweiterte Garantie“
  warrantyPeriodMonths Int      // z. B. 24, 60 Monate
  startDate           DateTime
  endDate             DateTime
  terms               String?   // Vertragsbedingungen
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model MaintenanceContract {
  id                  Int       @id @default(autoincrement())
  product             Product   @relation(fields: [productId], references: [id])
  productId           Int
  intervalMonths      Int       // z. B. alle 12 Monate
  lastMaintenanceDate DateTime?
  nextMaintenanceDate DateTime?
  reminderSent        Boolean   @default(false) // Flag, Erinnerung gesandt
  terms               String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

// Optional: OrderPosition, wenn Aufträge verwaltet werden
model OrderPosition {
  id                Int             @id @default(autoincrement())
  product           Product         @relation(fields: [productId], references: [id])
  productId         Int
  serialOrBatch     SerialOrBatch?  @relation(fields: [serialOrBatchId], references: [id])
  serialOrBatchId   Int?
  quantity          Int
  // weitere Felder: Auftrag, Preis, Datum etc.
  createdAt         DateTime        @default(now())
}
```

---

### Warum sind diese Felder wichtig?

- **CEDeclaration.harmonisedStandard**, **assessmentSystem**, **intendedUse**: Verpflichtende Angaben nach der EU-BauPVO / Regulation (EU) No. 305/2011 und neuer EU 2024/3110, Artikel 6 bzw. Artikel 10-11. ([eur-lex.europa.eu](https://eur-lex.europa.eu/eli/reg/2011/305/2024-11-17/eng?utm_source=openai))  
- **Essential Characteristics** wie Uw-Wert (Thermische Übertragung), Luftdurchlässigkeit, Schlagregendichtheit, Schallschutz etc.: Wesentliche Produkt-Kennwerte, die laut Normen für Fenster („Fenster-Norm EN 14351-1“ etc.) deklariert werden müssen. ([ekstrands.com](https://www.ekstrands.com/en/windows/ce-performance-windows/?utm_source=openai))  
- **environmentalPerformance**: Die neuere EU-Regulation verlangt Nachhaltigkeits- und Umweltverhalten über den Lebenszyklus; inklusive Verpackung. ([economie.fgov.be](https://economie.fgov.be/en/themes/enterprises/specific-sectors/construction/construction-products/regulation-eu-20243110/declaration-performance-and?utm_source=openai))  
- **archived / validUntil**: Aufbewahrungspflicht mindestens 10 Jahre nach Inverkehrbringen bzw. Ausstellung der Deklaration. ([eur-lex.europa.eu](https://eur-lex.europa.eu/eli/reg/2011/305/2024-11-17/eng?utm_source=openai))  
- **SerialOrBatch**: Zur Rückverfolgbarkeit: Seriennummer bedeutet einzelnes Stück; Charge mehrere Stücke mit gleicher Charge; Stückzahl, Produktpositionen und Reklamationen mit dieser Charge/Seriennummer.  
- **Material / Supplier**: Für Materialdaten, Lieferanten-Rückmeldung bei Reklamationen, technische Eigenschaften notwendig für Prüfung und Nachkalkulation.  
- **Complaint**: Ticket-System für Mängel, Ursache & Maßnahmen; Verknüpfung zu Seriennummer/Charge und evtl. Lieferant.  
- **CostEstimation**: Soll-/Ist-Kostenanalyse für Angebot vs tatsächliche Kosten, um Wirtschaftlichkeit zu überwachen.  
- **MaintenanceContract & WarrantyContract**: Garantie und Wartung sind Bestandteile von Lieferverträgen; Intervalle & Erinnerungen helfen Fristen einzuhalten.

---

## Beispiel: CE-Leistungserklärung für ein Kunststoff-Fenster (Beispiel-Produkt)

Ein JSON-Beispiel, wie eine CE-Leistungserklärung strukturiert sein könnte, gefüllt mit fiktiven aber realistischen Werten:

```json
{
  "declarationNumber": "DOP-JSF-2025-0001",
  "productType": "Fenster Kunststoff 3Kammer Profil",
  "productId": 101,
  "issueDate": "2025-06-15",
  "manufacturerName": "JS Fenster GmbH",
  "manufacturerAddress": "Musterstraße 1, 12345 Musterstadt, Deutschland",
  "harmonisedStandard": "EN 14351-1:2006+A2:2016",
  "assessmentSystem": "System 3",
  "intendedUse": "Außenfenster, Zweifachverglasung, Wohngebäude",
  "thermalTransmittanceUw": 1.2,
  "airPermeabilityClass": "Class 4",
  "watertightnessClass": "Class 9A",
  "soundReductionRw": 32.0,
  "windLoadResistanceClass": "Class C3 / 3",
  "safetyGlazing": true,
  "environmentalPerformance": {
    "lifeCycleModuleA1-A3": {
      "globalWarmingPotential": 5.3,      // kg CO₂-Äquivalent pro m²
      "recycledContent": 12.5             // in Prozent
    },
    "lifeCycleModuleC2": {
      "disposalImpact": 0.2
    },
    "packaging": {
      "material": "Karton + Schaumstoffe",
      "recycledContent": 45
    }
  },
  "validUntil": "2035-06-15",
  "documentUrl": "https://jsfenster.de/ce/DOP-JSF-2025-0001.pdf"
}
```

---

Wenn du möchtest, kann ich dir auch ein vollständiges ER-Diagramm liefern oder Erweiterungen zur Produktion / Versand integrieren – sag einfach Bescheid!